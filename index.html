<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Malefiz ‚Äî v9 (barricades instant + correctifs handlers)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
  /* =========================
     VARIABLES DE COULEUR (MODERNE)
     ========================= */
  :root{
    --bg:#0f172a;              /* fond global sombre (Slate 900) */
    --bg-soft:#1e293b;         /* (Slate 800) */
    --panel:#f1f5f9;           /* cartes tr√®s claires (Slate 50) */
    --panel-soft:#e2e8f0;      /* (Slate 200) */
    --accent:#f97316;          /* orange chaleureux (Orange 600) */
    --accent-soft:rgba(249,115,22,.12); /* Ombre douce */
    --accent-strong:#ea580c;    /* (Orange 700) */
    --accent-alt:#3b82f6;      /* bleu secondaire fun (Blue 500) */
    --text:#0f172a;            /* Texte sombre */
    --text-soft:#64748b;        /* Texte secondaire (Slate 500) */
    --border-soft:rgba(71,85,105,.5); /* Bordure l√©g√®re (Slate 600 alpha) */
    --danger:#ef4444;
  }

  *{box-sizing:border-box}

  body{
    margin:0;
    min-height:100vh;
    background:
      radial-gradient(circle at 0% 0%,var(--bg-soft) 0,var(--bg) 40%),
      radial-gradient(circle at 100% 100%,var(--bg) 0,var(--bg) 55%);
    color:var(--text);
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,sans-serif;
  }

  /* =========================
     CARTES / LAYOUT G√âN√âRAL
     ========================= */

  .card{
    background:
      radial-gradient(circle at 0 0,rgba(249,115,22,.04) 0,transparent 55%),
      linear-gradient(160deg,var(--panel),var(--panel-soft));
    border:1px solid var(--border-soft);
    border-radius:18px;
    padding:18px 16px;
    margin:14px;
    /* Ombres plus modernes et moins lourdes */
    box-shadow:
      0 16px 36px rgba(15,23,42,.2),
      0 0 0 1px rgba(71,85,105,.15);
  }

  .row{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:flex-start;
  }

  .col{
    display:flex;
    flex-direction:column;
    gap:8px;
  }

  h3{
    margin:0 0 12px;
    font-size:20px;
    letter-spacing:.1em;
    text-transform:uppercase;
    color:var(--text); /* Utilis√© la variable text */
    display:flex;
    align-items:center;
    gap:8px;
  }

  h3::before{
    content:"üéØ";
    font-size:18px;
    color:var(--accent-strong);
  }

  label{
    font-size:12px;
    text-transform:uppercase;
    letter-spacing:.08em;
    color:var(--text-soft);
  }

  /* =========================
     FORMULAIRES & CHAMPS
     ========================= */

  input,
  select,
  button{
    font:inherit;
    border-radius:10px;
    border:1px solid var(--border-soft);
    background:#f9fafb;
    padding:9px 13px;
    color:var(--text);
    outline:none;
    transition:
      border-color .14s ease,
      box-shadow .14s ease,
      background-color .12s ease,
      transform .08s ease,
      opacity .12s ease;
  }

  input::placeholder{
    color:rgba(156,163,175,.9);
  }

  input:focus,
  select:focus{
    border-color:var(--accent);
    box-shadow:0 0 0 2px rgba(249,115,22,.25);
    background:#ffffff;
  }

  select{
    padding-right:28px;
    background-image:linear-gradient(45deg,transparent 50%,var(--text-soft) 50%),
                     linear-gradient(135deg,var(--text-soft) 50%,transparent 50%);
    background-position:calc(100% - 14px) 12px, calc(100% - 9px) 12px;
    background-size:6px 6px,6px 6px;
    background-repeat:no-repeat;
    appearance:none;
  }

  /* =========================
     BOUTONS (MENU & IN-GAME)
     ========================= */

  button{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:8px;
    border-radius:10px;
    background:
      linear-gradient(135deg,var(--panel),var(--panel-soft));
    border-color:var(--border-soft);
    color:var(--text);
    font-weight:600;
    cursor:pointer;
    padding-inline:16px;
    box-shadow:
      0 1px 0 rgba(71,85,105,.4), /* Ombre int√©rieure subtile */
      0 4px 10px rgba(15,23,42,.08); /* Ombre flottante l√©g√®re */
  }

  button.primary{
    background:
      linear-gradient(135deg,var(--accent),var(--accent-strong));
    border-color:transparent;
    color:#fffbeb;
    box-shadow:
      0 1px 0 rgba(194,65,12,.7),
      0 8px 16px rgba(249,115,22,.4); /* Orange plus doux */
  }

  /* Ic√¥nes sur les boutons */
  #m_create::before{
    content:"‚ú®";
    font-size:15px;
  }
  #m_join::before{
    content:"üë•";
    font-size:15px;
  }
  #m_start::before{
    content:"‚ñ∂Ô∏è";
  }
  #roll::before{
    content:"üé≤";
  }

  #menu .row[style*="margin-top"] button{
    min-width:180px;
    justify-content:center;
  }

  button:disabled{
    opacity:.45;
    cursor:not-allowed;
    box-shadow:none;
    transform:none;
  }

  button:not(:disabled):hover{
    transform:translateY(-1px);
    box-shadow:
      0 2px 0 rgba(71,85,105,.5),
      0 8px 18px rgba(15,23,42,.12);
  }

  button:not(:disabled):active{
    transform:translateY(1px);
    box-shadow:
      inset 0 1px 3px rgba(15,23,42,.15);
  }

  button.primary:not(:disabled):hover{
    box-shadow:
      0 2px 0 rgba(194,65,12,.8),
      0 10px 20px rgba(249,115,22,.5);
  }

  /* =========================
     ZONE LOBBY & BADGES JOUEURS
     ========================= */

  #lobby{
    margin-top:10px;
    padding:10px 10px 8px;
    border-radius:14px;
    background:linear-gradient(135deg,var(--panel),var(--panel-soft));
    border:1px dashed var(--border-soft);
  }

  #lobbyList .tag,
  #players .tag{
    padding:5px 10px;
    border-radius:999px;
    background:var(--bg-soft);
    border:1px solid var(--bg);
    font-size:12px;
    display:inline-flex;
    align-items:center;
    gap:6px;
    color:#e2e8f0;
  }

  .tag .dot{
    display:inline-block;
    width:9px;
    height:9px;
    border-radius:999px;
    box-shadow:0 0 0 1px var(--bg),0 0 6px var(--bg-soft);
  }

  .notice{
    font-size:12px;
    color:var(--text-soft);
    opacity:.95;
  }

  /* =========================
     PLATEAU / SVG
     ========================= */

  #wrap{
    overflow:hidden;
    border-radius:18px;
    border:1px solid var(--border-soft);
    background:
      radial-gradient(circle at 10% 0%,#fef08a 0,#f8fafc 55%), /* Jaune clair + Gris tr√®s clair */
      linear-gradient(180deg,#fefce8,#eff6ff); /* Beige clair -> Bleu clair tr√®s doux */
    position:relative;
    box-shadow:
      0 16px 36px rgba(15,23,42,.2),
      0 0 0 1px rgba(71,85,105,.15);
  }

  #svg{
    touch-action:none;
    display:block;
    width:100%;
    height:70vh;
  }

  /* chemins */
  .edge{
    stroke:var(--text-soft);
    stroke-width:4;
    stroke-linecap:round;
    opacity:.85;
    filter:drop-shadow(0 1px 2px rgba(15,23,42,.3));
  }

  /* ronds du plateau */
  .node{
    fill:#f9fafb;
    stroke:#f59e0b; /* Jaune or */
    stroke-width:2.4;
    filter:
      drop-shadow(0 1px 2px rgba(71,85,105,.3))
      drop-shadow(0 0 3px rgba(100,116,139,.5));
  }

  /* Barricades */
  .barricade{
    fill:var(--text); /* Sombre */
    stroke:var(--accent-strong);
    stroke-width:2.4;
    filter:
      drop-shadow(0 2px 4px rgba(15,23,42,.7))
      drop-shadow(0 0 5px rgba(249,115,22,.5)); /* Orange de l'accent */
  }

  /* Pions : on garde les couleurs JS, juste la pr√©sentation */
  .pawn{
    stroke:var(--bg);
    stroke-width:3;
    filter:
      drop-shadow(0 2px 4px rgba(15,23,42,.7))
      drop-shadow(0 0 3px rgba(15,23,42,.6));
  }

  /* Surbrillance coups possibles */
  .hint-origin,
  .hint-target{
    fill:transparent;
    cursor:pointer;
    pointer-events:all;
  }

  .hint-origin{
    stroke:var(--accent-alt); /* Bleu moderne */
    stroke-width:3;
    stroke-dasharray:4 4;
    filter:
      drop-shadow(0 0 6px rgba(59,130,246,.8))
      drop-shadow(0 0 2px rgba(15,23,42,.7));
  }

  .hint-target{
    stroke:#f59e0b; /* Jaune/Ambre */
    stroke-width:3;
    filter:
      drop-shadow(0 0 8px rgba(245,158,11,.8))
      drop-shadow(0 0 2px rgba(15,23,42,.7));
  }

  .select{
    fill:transparent;
    stroke:#a855f7; /* Violet */
    stroke-width:4;
    pointer-events:none;
    filter:
      drop-shadow(0 0 10px rgba(168,85,247,.8))
      drop-shadow(0 0 4px rgba(15,23,42,.7));
  }

  /* =========================
     JOURNAL
     ========================= */

  #log{
    height:160px;
    overflow:auto;
    background:
      radial-gradient(circle at 0 0,var(--panel) 0,var(--panel-soft) 60%);
    border:1px solid var(--border-soft);
    border-radius:12px;
    padding:10px;
    white-space:pre-wrap;
    font-size:12px;
    font-family:ui-monospace,Menlo,Monaco,"SF Mono",monospace;
    color:var(--bg);
  }

  #log::-webkit-scrollbar{
    width:6px;
  }
  #log::-webkit-scrollbar-track{
    background:transparent;
  }
  #log::-webkit-scrollbar-thumb{
    background:var(--text-soft);
    border-radius:999px;
  }

  /* =========================
     ZONE D√â & INFO TOUR
     ========================= */

  #game .row[style*="justify-content:space-between"]{
    row-gap:8px;
  }

  #roll{
    font-size:14px;
    padding-inline:18px;
  }

  #dice{
    min-width:130px;
    padding:7px 14px;
    border-radius:12px;
    border:1px solid rgba(148,163,184,.8);
    background:
      radial-gradient(circle at 0 0,rgba(255,255,255,1) 0,rgba(243,244,246,1) 60%); /* Blanc/Gris tr√®s clair */
    font-weight:700;
    text-align:center;
    box-shadow:
      0 1px 0 rgba(249,250,251,1),
      0 6px 12px rgba(15,23,42,.08);
    color:var(--text); /* Texte sombre */
  }

  #turn{
    color:var(--accent-strong);
    font-weight:700;
  }

  /* =========================
     OVERLAY VICTOIRE (NOUVEAU)
     ========================= */
  #winOverlay{
    position:fixed;
    inset:0;
    display:none;
    align-items:center;
    justify-content:center;
    background:
      radial-gradient(circle at 20% 0%,rgba(254,240,138,.3) 0,transparent 45%),
      radial-gradient(circle at 80% 100%,rgba(191,219,254,.4) 0,transparent 55%),
      rgba(15,23,42,.65); /* Fond plus sombre */
    z-index:9999;
  }

  #winBox{
    background:
      radial-gradient(circle at 0 0,rgba(254,243,199,1) 0,transparent 55%),
      radial-gradient(circle at 100% 100%,rgba(191,219,254,1) 0,transparent 55%),
      linear-gradient(145deg,var(--panel),var(--panel-soft)); /* Utilisation des variables */
    border:1px solid var(--border-soft);
    border-radius:20px;
    padding:22px 22px 18px;
    max-width:520px;
    width:90%;
    text-align:center;
    box-shadow:
      0 24px 60px rgba(15,23,42,.35),
      0 0 0 1px rgba(71,85,105,.2);
    color:var(--text);
  }

  #winBox h2{
    margin:0 0 8px;
    font-size:22px;
    letter-spacing:.16em;
    text-transform:uppercase;
    color:var(--accent-strong); /* Titre en orange fort */
  }
  
  #winBox h2::before{
    content:"üèÜ";
    margin-right:6px;
    font-size:20px;
  }
  
  #winBox p{
    margin:0;
    font-size:14px;
    color:var(--text-soft);
  }

  #winClose{
    margin-top:16px;
    padding:9px 22px;
    border-radius:10px;
    border:1px solid var(--border-soft);
    background:
      linear-gradient(135deg,var(--panel),var(--panel-soft));
    color:var(--text);
    cursor:pointer;
    font-size:13px;
    font-weight:600;
    transition:
      transform .08s ease,
      box-shadow .18s ease,
      border-color .18s ease,
      background .18s ease;
  }

  #winClose:hover{
    transform:translateY(-1px);
    box-shadow:
      0 2px 0 rgba(71,85,105,.4),
      0 10px 22px rgba(15,23,42,.12);
    border-color:var(--accent); /* Bordure orange au survol */
  }

  </style>
</head>
<body>
<section id="menu" class="card">
  <h3>Malefiz ‚Äî cr√©er/rejoindre</h3>
  <div class="row">
    <div class="col" style="min-width:180px;flex:1">
      <label>Pseudo</label><input id="m_name" placeholder="ex: Camille">
    </div>
    <div class="col" style="width:150px">
      <label>Couleur</label>
      <select id="m_color"><option value="red">Rouge</option><option value="blue">Bleu</option><option value="green">Vert</option><option value="yellow">Jaune</option></select>
    </div>
    <div class="col" style="min-width:180px;flex:1">
      <label>Code de partie</label><input id="m_game" placeholder="ex: famille1">
    </div>
  </div>
  <div class="row" style="margin-top:6px">
    <button id="m_create" class="primary">Cr√©er la partie</button>
    <button id="m_join">Rejoindre la partie</button>
  </div>
  <div id="lobby" style="display:none;margin-top:10px">
    <div><strong>Joueurs connect√©s</strong></div>
    <div id="lobbyList" class="row" style="gap:6px"></div>
    <div class="row" style="margin-top:10px;align-items:center;gap:10px">
      <button id="m_start" class="primary">D√©marrer la partie</button>
      <span class="notice">Seul l'h√¥te peut d√©marrer. Minimum 2 joueurs.</span>
    </div>
  </div>
</section>

<section id="game" class="card" style="display:none">
  <div class="row" style="align-items:center;justify-content:space-between">
    <div class="row" style="gap:12px;align-items:center">
      <button id="roll">üé≤ Lancer le d√©</button>
      <div id="dice">D√© : ‚Äî</div>
      <div>Tour : <strong id="turn">‚Äî</strong></div>
      <div id="phase" class="notice"></div>
    </div>
    <div id="players" class="row" style="gap:6px"></div>
  </div>
  <div id="wrap" style="margin-top:10px">
    <svg id="svg" viewBox="0 0 1090 1300" xmlns="http://www.w3.org/2000/svg">
      <g id="edges"></g>
      <g id="nodes"></g>
      <g id="homes"></g>
      <g id="pieces"></g>
      <g id="ui"></g>
    </svg>
  </div>
  <div class="col" style="margin-top:10px">
    <div><strong>Journal</strong></div><div id="log"></div>
  </div>
</section>

<div id="winOverlay" role="dialog" aria-modal="true" aria-labelledby="winTitle">
  <div id="winBox">
    <h2 id="winTitle">Victoire !</h2>
    <p id="winMsg">Une victoire l√©gendaire ! Pr√©parez-vous pour la prochaine partie.</p>
    <button id="winClose" class="primary">Fermer</button>
  </div>
</div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getDatabase, ref, set, onValue, runTransaction } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

// ‚ö†Ô∏è COLLE ICI TA CONFIG
const firebaseConfig = {

  apiKey: "AIzaSyDqZOF5bsuzH7dH3TvQiY9JknZWXYJsEE4",

  authDomain: "barricade-en-ligne.firebaseapp.com",

  databaseURL: "https://barricade-en-ligne-default-rtdb.europe-west1.firebasedatabase.app",

  projectId: "barricade-en-ligne",

  storageBucket: "barricade-en-ligne.firebasestorage.app",

  messagingSenderId: "1094029683667",

  appId: "1:1094029683667:web:e3d6b9ad3b44b337d29d26"

};


const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const COLORS={red:"#e74b4b",blue:"#3a7bff",green:"#2fbf71",yellow:"#e5c14b"};
const NODES = [{"id": "n1", "x": 120, "y": 900, "n": 1}, {"id": "n2", "x": 170, "y": 900, "n": 2}, {"id": "n3", "x": 220, "y": 900, "n": 3}, {"id": "n4", "x": 270, "y": 900, "n": 4}, {"id": "n5", "x": 320, "y": 900, "n": 5}, {"id": "n6", "x": 370, "y": 900, "n": 6}, {"id": "n7", "x": 420, "y": 900, "n": 7}, {"id": "n8", "x": 470, "y": 900, "n": 8}, {"id": "n9", "x": 520, "y": 900, "n": 9}, {"id": "n10", "x": 570, "y": 900, "n": 10}, {"id": "n11", "x": 620, "y": 900, "n": 11}, {"id": "n12", "x": 670, "y": 900, "n": 12}, {"id": "n13", "x": 720, "y": 900, "n": 13}, {"id": "n14", "x": 770, "y": 900, "n": 14}, {"id": "n15", "x": 820, "y": 900, "n": 15}, {"id": "n16", "x": 870, "y": 900, "n": 16}, {"id": "n17", "x": 920, "y": 900, "n": 17}, {"id": "n18", "x": 120, "y": 840, "n": 18}, {"id": "n19", "x": 320, "y": 840, "n": 19}, {"id": "n20", "x": 520, "y": 840, "n": 20}, {"id": "n21", "x": 720, "y": 840, "n": 21}, {"id": "n22", "x": 920, "y": 840, "n": 22}, {"id": "n23", "x": 120, "y": 780, "n": 23}, {"id": "n24", "x": 170, "y": 780, "n": 24}, {"id": "n25", "x": 220, "y": 780, "n": 25}, {"id": "n26", "x": 270, "y": 780, "n": 26}, {"id": "n27", "x": 320, "y": 780, "n": 27}, {"id": "n28", "x": 370, "y": 780, "n": 28}, {"id": "n29", "x": 420, "y": 780, "n": 29}, {"id": "n30", "x": 470, "y": 780, "n": 30}, {"id": "n31", "x": 520, "y": 780, "n": 31}, {"id": "n32", "x": 570, "y": 780, "n": 32}, {"id": "n33", "x": 620, "y": 780, "n": 33}, {"id": "n34", "x": 670, "y": 780, "n": 34}, {"id": "n35", "x": 720, "y": 780, "n": 35}, {"id": "n36", "x": 770, "y": 780, "n": 36}, {"id": "n37", "x": 820, "y": 780, "n": 37}, {"id": "n38", "x": 870, "y": 780, "n": 38}, {"id": "n39", "x": 920, "y": 780, "n": 39}, {"id": "n40", "x": 220, "y": 720, "n": 40}, {"id": "n41", "x": 420, "y": 720, "n": 41}, {"id": "n42", "x": 620, "y": 720, "n": 42}, {"id": "n43", "x": 820, "y": 720, "n": 43}, {"id": "n44", "x": 220, "y": 660, "n": 44}, {"id": "n45", "x": 270, "y": 660, "n": 45}, {"id": "n46", "x": 320, "y": 660, "n": 46}, {"id": "n47", "x": 370, "y": 660, "n": 47}, {"id": "n48", "x": 420, "y": 660, "n": 48}, {"id": "n49", "x": 470, "y": 660, "n": 49}, {"id": "n50", "x": 520, "y": 660, "n": 50}, {"id": "n51", "x": 570, "y": 660, "n": 51}, {"id": "n52", "x": 620, "y": 660, "n": 52}, {"id": "n53", "x": 670, "y": 660, "n": 53}, {"id": "n54", "x": 720, "y": 660, "n": 54}, {"id": "n55", "x": 770, "y": 660, "n": 55}, {"id": "n56", "x": 820, "y": 660, "n": 56}, {"id": "n57", "x": 320, "y": 600, "n": 57}, {"id": "n58", "x": 720, "y": 600, "n": 58}, {"id": "n59", "x": 320, "y": 540, "n": 59}, {"id": "n60", "x": 370, "y": 540, "n": 60}, {"id": "n61", "x": 420, "y": 540, "n": 61}, {"id": "n62", "x": 470, "y": 540, "n": 62}, {"id": "n63", "x": 520, "y": 540, "n": 63}, {"id": "n64", "x": 570, "y": 540, "n": 64}, {"id": "n65", "x": 620, "y": 540, "n": 65}, {"id": "n66", "x": 670, "y": 540, "n": 66}, {"id": "n67", "x": 720, "y": 540, "n": 67}, {"id": "n68", "x": 420, "y": 480, "n": 68}, {"id": "n69", "x": 620, "y": 480, "n": 69}, {"id": "n70", "x": 420, "y": 420, "n": 70}, {"id": "n71", "x": 470, "y": 420, "n": 71}, {"id": "n72", "x": 520, "y": 420, "n": 72}, {"id": "n73", "x": 570, "y": 420, "n": 73}, {"id": "n74", "x": 620, "y": 420, "n": 74}, {"id": "n75", "x": 520, "y": 360, "n": 75}, {"id": "n76", "x": 120, "y": 300, "n": 76}, {"id": "n77", "x": 170, "y": 300, "n": 77}, {"id": "n78", "x": 220, "y": 300, "n": 78}, {"id": "n79", "x": 270, "y": 300, "n": 79}, {"id": "n80", "x": 320, "y": 300, "n": 80}, {"id": "n81", "x": 370, "y": 300, "n": 81}, {"id": "n82", "x": 420, "y": 300, "n": 82}, {"id": "n83", "x": 470, "y": 300, "n": 83}, {"id": "n84", "x": 520, "y": 300, "n": 84}, {"id": "n85", "x": 570, "y": 300, "n": 85}, {"id": "n86", "x": 620, "y": 300, "n": 86}, {"id": "n87", "x": 670, "y": 300, "n": 87}, {"id": "n88", "x": 720, "y": 300, "n": 88}, {"id": "n89", "x": 770, "y": 300, "n": 89}, {"id": "n90", "x": 820, "y": 300, "n": 90}, {"id": "n91", "x": 870, "y": 300, "n": 91}, {"id": "n92", "x": 920, "y": 300, "n": 92}, {"id": "n93", "x": 120, "y": 240, "n": 93}, {"id": "n94", "x": 92...
</script>
</body>
</html>
